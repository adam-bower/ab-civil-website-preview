{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import'./AutoResizeWrapper.css';import{jsx as _jsx}from\"react/jsx-runtime\";const AutoResizeWrapper=_ref=>{let{children,padding=20}=_ref;const contentRef=useRef(null);const[lastHeight,setLastHeight]=useState(0);const resizeObserverRef=useRef(null);const mutationObserverRef=useRef(null);const rafRef=useRef(null);// Function to calculate and send height\nconst updateHeight=()=>{if(!contentRef.current)return;// Cancel any pending animation frame\nif(rafRef.current){cancelAnimationFrame(rafRef.current);}rafRef.current=requestAnimationFrame(()=>{if(!contentRef.current)return;// Get the actual height of the content\nconst contentHeight=contentRef.current.scrollHeight;const totalHeight=contentHeight+padding;// Only send update if height has changed\nif(totalHeight!==lastHeight){setLastHeight(totalHeight);// Send height to parent frame (Wix)\nif(window.parent!==window){window.parent.postMessage({type:'resize-iframe',height:totalHeight,source:'ab-civil-form'},'*');console.log('Height update sent to parent:',totalHeight);}// Also try Wix-specific method if available\nif(window.Wix&&window.Wix.setHeight){window.Wix.setHeight(totalHeight);}}});};// Debounced update function\nconst debouncedUpdate=(()=>{let timeoutId;return()=>{clearTimeout(timeoutId);timeoutId=setTimeout(()=>{updateHeight();},100);};})();useEffect(()=>{var _contentRef$current;// Initial height update\nupdateHeight();// Set up ResizeObserver for element size changes\nif(window.ResizeObserver&&contentRef.current){resizeObserverRef.current=new ResizeObserver(entries=>{for(let entry of entries){debouncedUpdate();}});resizeObserverRef.current.observe(contentRef.current);}// Set up MutationObserver for DOM changes\nif(window.MutationObserver&&contentRef.current){mutationObserverRef.current=new MutationObserver(mutations=>{// Check if any mutations actually affected layout\nconst hasLayoutChange=mutations.some(mutation=>{return mutation.type==='childList'||mutation.type==='attributes'&&(mutation.attributeName==='style'||mutation.attributeName==='class');});if(hasLayoutChange){debouncedUpdate();}});mutationObserverRef.current.observe(contentRef.current,{attributes:true,childList:true,subtree:true,attributeFilter:['style','class']});}// Listen for window resize events\nconst handleResize=()=>{debouncedUpdate();};window.addEventListener('resize',handleResize);// Listen for custom events that might trigger height changes\nconst handleFormChange=()=>{debouncedUpdate();};window.addEventListener('form-content-changed',handleFormChange);// Listen for image loads within the content\nconst images=((_contentRef$current=contentRef.current)===null||_contentRef$current===void 0?void 0:_contentRef$current.getElementsByTagName('img'))||[];const imageLoadHandlers=[];Array.from(images).forEach(img=>{if(!img.complete){const handler=()=>debouncedUpdate();img.addEventListener('load',handler);imageLoadHandlers.push({img,handler});}});// Update on any animation frames for smooth transitions\nlet animationId;const checkHeight=()=>{updateHeight();animationId=requestAnimationFrame(checkHeight);};// Start checking but stop after 2 seconds to save resources\nanimationId=requestAnimationFrame(checkHeight);const stopAnimationTimeout=setTimeout(()=>{cancelAnimationFrame(animationId);},2000);// Cleanup\nreturn()=>{if(resizeObserverRef.current){resizeObserverRef.current.disconnect();}if(mutationObserverRef.current){mutationObserverRef.current.disconnect();}if(rafRef.current){cancelAnimationFrame(rafRef.current);}cancelAnimationFrame(animationId);clearTimeout(stopAnimationTimeout);window.removeEventListener('resize',handleResize);window.removeEventListener('form-content-changed',handleFormChange);imageLoadHandlers.forEach(_ref2=>{let{img,handler}=_ref2;img.removeEventListener('load',handler);});};},[]);// Empty dependency array for mount-only effect\n// Trigger update when children change\nuseEffect(()=>{debouncedUpdate();},[children]);return/*#__PURE__*/_jsx(\"div\",{ref:contentRef,className:\"auto-resize-wrapper\",children:children});};export default AutoResizeWrapper;","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","AutoResizeWrapper","_ref","children","padding","contentRef","lastHeight","setLastHeight","resizeObserverRef","mutationObserverRef","rafRef","updateHeight","current","cancelAnimationFrame","requestAnimationFrame","contentHeight","scrollHeight","totalHeight","window","parent","postMessage","type","height","source","console","log","Wix","setHeight","debouncedUpdate","timeoutId","clearTimeout","setTimeout","_contentRef$current","ResizeObserver","entries","entry","observe","MutationObserver","mutations","hasLayoutChange","some","mutation","attributeName","attributes","childList","subtree","attributeFilter","handleResize","addEventListener","handleFormChange","images","getElementsByTagName","imageLoadHandlers","Array","from","forEach","img","complete","handler","push","animationId","checkHeight","stopAnimationTimeout","disconnect","removeEventListener","_ref2","ref","className"],"sources":["/Users/adambower/Dev/ab-civil-website-preview/src/shared/components/AutoResizeWrapper/AutoResizeWrapper.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport './AutoResizeWrapper.css';\n\nconst AutoResizeWrapper = ({ children, padding = 20 }) => {\n  const contentRef = useRef(null);\n  const [lastHeight, setLastHeight] = useState(0);\n  const resizeObserverRef = useRef(null);\n  const mutationObserverRef = useRef(null);\n  const rafRef = useRef(null);\n\n  // Function to calculate and send height\n  const updateHeight = () => {\n    if (!contentRef.current) return;\n\n    // Cancel any pending animation frame\n    if (rafRef.current) {\n      cancelAnimationFrame(rafRef.current);\n    }\n\n    rafRef.current = requestAnimationFrame(() => {\n      if (!contentRef.current) return;\n\n      // Get the actual height of the content\n      const contentHeight = contentRef.current.scrollHeight;\n      const totalHeight = contentHeight + padding;\n\n      // Only send update if height has changed\n      if (totalHeight !== lastHeight) {\n        setLastHeight(totalHeight);\n        \n        // Send height to parent frame (Wix)\n        if (window.parent !== window) {\n          window.parent.postMessage({\n            type: 'resize-iframe',\n            height: totalHeight,\n            source: 'ab-civil-form'\n          }, '*');\n          \n          console.log('Height update sent to parent:', totalHeight);\n        }\n\n        // Also try Wix-specific method if available\n        if (window.Wix && window.Wix.setHeight) {\n          window.Wix.setHeight(totalHeight);\n        }\n      }\n    });\n  };\n\n  // Debounced update function\n  const debouncedUpdate = (() => {\n    let timeoutId;\n    return () => {\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(() => {\n        updateHeight();\n      }, 100);\n    };\n  })();\n\n  useEffect(() => {\n    // Initial height update\n    updateHeight();\n\n    // Set up ResizeObserver for element size changes\n    if (window.ResizeObserver && contentRef.current) {\n      resizeObserverRef.current = new ResizeObserver((entries) => {\n        for (let entry of entries) {\n          debouncedUpdate();\n        }\n      });\n      resizeObserverRef.current.observe(contentRef.current);\n    }\n\n    // Set up MutationObserver for DOM changes\n    if (window.MutationObserver && contentRef.current) {\n      mutationObserverRef.current = new MutationObserver((mutations) => {\n        // Check if any mutations actually affected layout\n        const hasLayoutChange = mutations.some(mutation => {\n          return mutation.type === 'childList' || \n                 mutation.type === 'attributes' && \n                 (mutation.attributeName === 'style' || \n                  mutation.attributeName === 'class');\n        });\n        \n        if (hasLayoutChange) {\n          debouncedUpdate();\n        }\n      });\n\n      mutationObserverRef.current.observe(contentRef.current, {\n        attributes: true,\n        childList: true,\n        subtree: true,\n        attributeFilter: ['style', 'class']\n      });\n    }\n\n    // Listen for window resize events\n    const handleResize = () => {\n      debouncedUpdate();\n    };\n    window.addEventListener('resize', handleResize);\n\n    // Listen for custom events that might trigger height changes\n    const handleFormChange = () => {\n      debouncedUpdate();\n    };\n    window.addEventListener('form-content-changed', handleFormChange);\n\n    // Listen for image loads within the content\n    const images = contentRef.current?.getElementsByTagName('img') || [];\n    const imageLoadHandlers = [];\n    \n    Array.from(images).forEach(img => {\n      if (!img.complete) {\n        const handler = () => debouncedUpdate();\n        img.addEventListener('load', handler);\n        imageLoadHandlers.push({ img, handler });\n      }\n    });\n\n    // Update on any animation frames for smooth transitions\n    let animationId;\n    const checkHeight = () => {\n      updateHeight();\n      animationId = requestAnimationFrame(checkHeight);\n    };\n    \n    // Start checking but stop after 2 seconds to save resources\n    animationId = requestAnimationFrame(checkHeight);\n    const stopAnimationTimeout = setTimeout(() => {\n      cancelAnimationFrame(animationId);\n    }, 2000);\n\n    // Cleanup\n    return () => {\n      if (resizeObserverRef.current) {\n        resizeObserverRef.current.disconnect();\n      }\n      if (mutationObserverRef.current) {\n        mutationObserverRef.current.disconnect();\n      }\n      if (rafRef.current) {\n        cancelAnimationFrame(rafRef.current);\n      }\n      cancelAnimationFrame(animationId);\n      clearTimeout(stopAnimationTimeout);\n      window.removeEventListener('resize', handleResize);\n      window.removeEventListener('form-content-changed', handleFormChange);\n      \n      imageLoadHandlers.forEach(({ img, handler }) => {\n        img.removeEventListener('load', handler);\n      });\n    };\n  }, []); // Empty dependency array for mount-only effect\n\n  // Trigger update when children change\n  useEffect(() => {\n    debouncedUpdate();\n  }, [children]);\n\n  return (\n    <div ref={contentRef} className=\"auto-resize-wrapper\">\n      {children}\n    </div>\n  );\n};\n\nexport default AutoResizeWrapper;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}